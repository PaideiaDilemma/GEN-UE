%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%	   mmm  mmmmmm mm   m        m    m mmmmmm mmmmm	%%
%%       m"   " #      #"m  #        #    # #      #		%%
%%       #   mm #mmmmm # #m #        #    # #mmmmm """"mm	%%
%%	 #    # #      #  # #  """   #    # #           #	%%
%%	  "mmm" #mmmmm #   ##        "mmmm" #mmmmm "mmm#"	%%
%%								%%
%%                                                              %%
%%                                                              %%
%%      Grundlagen der Elektrischen Netzwerke, UE               %%
%%      Gruppe 5, Team F                                        %%
%%      Authors: Severin Wolf, Maximilian Seidler.              %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper]{article}
\usepackage{amsmath}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{listings}
\geometry{a4paper,left=3cm,right=2cm, top=2cm, bottom=2cm} 
\usepackage[EFvoltages, european, straightvoltages]{circuitikz}

%tikz
\ctikzset{resistor = european}
\usetikzlibrary{decorations.pathreplacing}

%no paragraph indent
\setlength{\parindent}{0pt}

%for math, that does not fit
\renewcommand*{\arraystretch}{1.3}
\newcommand\scalemath[2]{\scalebox{#1}{\mbox{\ensuremath{\displaystyle #2}}}}

\newcommand\blfootnote[1]{%
	\begingroup
	\renewcommand\thefootnote{}\footnote{#1}%
	\addtocounter{footnote}{-1}%
	\endgroup
}

% upright differenzial symbol with good spacing included!!!
\makeatletter
\providecommand*{\diff}%
	{\@ifnextchar^{\DIfF}{\DIfF^{}}}
\def\DIfF^#1{%
	\mathop{\mathrm{\mathstrut d}}%
		\nolimits^{#1}\gobblespace
}
\def\gobblespace{%
	\futurelet\diffarg\opspace}
\def\opspace{%
	\let\DiffSpace\!%
	\ifx\diffarg(%
		\let\DiffSpace\relax
	\else
		\ifx\diffarg\{%
			\let\DiffSpace\relax
		\else
			\ifx\diffarg\{%
				\let\DiffSpace\relax
			\fi\fi\fi\DiffSpace}

\begin{document}
\pagestyle{empty} \enlargethispage*{25cm}\samepage{
\vspace*{-3cm}
\begin{center}
\begin{minipage}[!h]{16cm}
\hspace*{0.2cm}
\includegraphics[width=3.3cm]{./Figures/igte_logo}
\begin{tabular}{p{8cm}}
\vspace{0.2cm}
\centering{
\Large Institute of Fundamentals and Theory in
 Electrical Engineering\\
Graz University of Technology\\
~\\}
\end{tabular}
\includegraphics[width=3.3cm]{./Figures/TUG_logo}
\end{minipage}
		\Large
		\textbf{Fundamentals of Electrical Circuits} \vspace*{0.5cm}\\
		\textbf{5. Homework}\\
		Frequency Domain
		\vspace*{0.5cm}
		
		\large
		22. April 2021
	\end{center}}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	Consider the given circuit in time domain shown in figure \ref{part1}. The unknown element at the position marked by a questionmark is either a coil $L_x$ or a capacitor $C_x$. The voltage source is given with $u_s(t) = U_0 \cdot sin(\omega t)$. The following condition has to be met: 
	\begin{align}
		\label{Bedingung}
		\varphi_{\underline{U}_1}=\varphi_{\underline{I}_x}-30^\circ
	\end{align}
	\begin{enumerate}
		\item Construct a phasor diagram for this circuit (step-by-step). Assume a test voltage $\underline{U}_{RC,test} = 10~V$ in order to draw a \textbf{true to scale} phasor diagram of the circit. Use a different scaling factor for the voltages and currents in order to display them in a visual appealing way. The phasor diagram can be constructed by using Matlab. Mark the angle between $\underline{U}_1$ und $\underline{I}_x$ in the phasor diagram. \\\textbf{(1 point)}
		\begin{itemize}
			\item Determine with the phasor diagram the kind and the value of the unknown element (coil $L_x$ or capacitor $C_x$). Therefore draw all required voltages and currents in the phasor diagram.
			\item Is it possible to reach the given condition with a resistor $R_x$? If so $\Rightarrow$ Draw all required voltages and currents in the phasor diagram.
		\end{itemize}
		\item Calculate the value of the unknown element analytically which complies the requirement in \ref{Bedingung}. \\\textbf{(1 point)}
		\begin{itemize}
			\item Determine the function $\underline{F}$ ( $\underline{U_1} = \underline{F} \cdot \underline{I_x}$)  and the condition this function  $\underline{F}$ has to fulfill.
			\item Derive the expression for the unknown element $X_x$ \textbf{analytically} which satisfies the requirement in \ref{Bedingung}. The expression must be of the form $X_x = f(R, X_L, X_C)$ oder $X_x = f(R, \omega, L, C)$.\\
			The values should be inserted into this equation \textbf{after} the expression for $X_x$ is found.
		\end{itemize}
		
		\item For which condition for $X_L$, $X_C$ and $R$ is the solution for \textbf{?} a coil and for which condition is it a capacitor? \textbf{(0.5 points)}
		
		\item Calculate with element $X_x$ from part 2 the value of every current and voltage in the circuit (you can use Matlab for the calculation). \textbf{(0.5 points)}
		
		\item Construct a true-to-scale phasor diagram for the circuit using the calculated value of the unknown element. Choose a scaling factors that make sense. 
		\\\textbf{hint:} Use the command \textit{axis equal} in Matlab. \textbf{(1 point)}
		
		\item  LTspice: Simulate the circuit in LTspice to confirm the phase relation between the voltage $u_1$ and $i_x$. Use the initial conditions $u_C(t=0) = 0~V$ and $i_L(t=0) = 0~A$ for the coil and the capacitor. The angle between the two quantities in time domain can be calculated by measuring the time  $\Delta t$ with the cursor: $\varphi = \frac{\Delta t}{T}\cdot 360^\circ$. \textbf{(1 point)}
	\end{enumerate}
	\textbf{(Note: Please use peak values for your phasors)}
\pagebreak
	\subsection*{Given:}
	$R = 100~\Omega$ \qquad $C=10~\mu\text{F}$ \qquad $L = 70~\text{mH}$ \qquad $U_0 = 30~\text{V}$ \qquad $\omega = 1000~\text{s}^{-1}$
	\blfootnote{Deadline: 29.04.2021 - 9:00; presentation: team 5}
	
\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.8]{./Figures/homework5_circuit.eps}
	\label{part1}
	\caption{Given circuit}
\end{figure}
\section{Solution}
\subsection{Analytical calculations}
Assuming a Testvoltage $R_{RC, test} = 10V$ and letting $\varphi_{I_{R}}$ be $0$ degrees, we
constructed a true to scale phasor diagram. Voltages are scaled by  $\frac{1}{5}$ and Currents by
$15$. By constucting the diagram, it became clear, that the unknown element in Figure \ref{part1}
has to be an inductor.

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.8]{./Figures/phasors_1.png}
	\label{phasor_dia_1}
	\caption{Phasor Diagramm with $\varphi_{I_{R}} = 0$}
\end{figure}

\newpage

Now we calculate the value of the unknown element. We know from above it has to be a coil.
Note, that $X_C = \frac{-1}{\omega C}$
\begin{align*}
	\underline{U_1} = \underline{F} \cdot \underline{I_x}\\
	\underline{F} = \frac{R \cdot jX_C}{R + jX_C} + jX_L =
	\frac{R \cdot jX_C}{R + jX_C} + \frac{jX_L(R+jX_C)}{R + jX_C} = \frac{-X_LX_C + jRX_C + jRX_L}{R + jX_C}\\
	\underline{F} = \frac{a+jb}{c+jd} = \frac{(a+jb)(c-jd)}{c^2+d^2} = \frac{ac+bd}{c^2+d^2} + j\cdot\frac{bc-ad}{c^2+d^2}\\
	\varphi_{\underline{U_1}} = \varphi_{\underline{F}} + \varphi_{\underline{I_x}}\\
	\varphi_{\underline{F}} \overset{!}{=} -30\\
	\varphi_{\underline{F}} = \arctan \left(\frac{Im\{\underline{F}\}}{Re\{\underline{F}\}} \right) =
	\arctan \left(\frac{\frac{bc-ad}{c^2+d^2}}{\frac{ac+bd}{c^2+d^2}} \right) =
	\arctan \left(\frac{bc-ad}{ac+bd} \right) \overset{!}{=} -30\\
	\frac{bc-ad}{ac+bd} = \tan(-30) = -\frac{\sqrt{3}}{3}\\
	\frac{(RX_C+RX_L)R + X_CX_LX_C}{-X_CX_LR + (RX_C + RX_L)X_C} = 
	\frac{R^2X_C + R^2X_L + X_C^2X_L}{RX_C^2 + 0} = -\frac{\sqrt{3}}{3}\\
	3R^2X_C + 3R^2X_L + 3X_C^2X_L = -\sqrt{3}RX_C^2\\
	3R^2X_L + 3X_C^2X_L = -3R^2X_C -\sqrt{3}RX_C^2\\
	X_L(3R^2 + 3X_C^2) = -3R^2X_C -\sqrt{3}RX_C^2\\
	X_L = \frac{-3R^2X_C -\sqrt{3}RX_C^2}{3R^2 + 3X_C^2}\\
\end{align*}
Now we can insert $R, C$ and $\omega$ in order to calculate $X_L$
\begin{align*}
	X_L = \frac{-3 \cdot 100^2 \cdot \frac{-1}{0.01} -\sqrt{3} \cdot 100 \cdot \left(\frac{-1}{0.01}\right)^2}
	{3\cdot 100^2 + 3\left(\frac{-1}{0.01}\right)^2} = 21.1325
\end{align*}

\end{document}
